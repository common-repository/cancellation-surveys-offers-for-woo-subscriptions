const CancellationOfferPopup=function($popupWrapper){this.$popupWrapper=$popupWrapper,this.selectedSurveyAnswer=!1,this.init=function(){jQuery("[href^=#cancellation-popup]").on("click",this.open.bind(this)),jQuery(document).on("click",".cancellation-offer-popup-survey-item",this.surveyAnswerSelected.bind(this)),jQuery(document).on("keypress",".cancellation-offer-popup-survey-item",function(e){13!==e.keyCode&&32!==e.keyCode||jQuery(this).click()}),jQuery(document).on("click",".cancellation-offer-popup-survey__dismiss-button",function(){jQuery.magnificPopup.close()}),this.$popupWrapper.find(".cancellation-offer-popup-survey-items__textarea").on("input change",function(){this.selectedSurveyAnswer.textAnswerEnabled&&(!this.selectedSurveyAnswer||this.getTextAnswer().length<5?this.blockContinueButton():this.unblockContinueButton())}.bind(this)),this.$popupWrapper.find(".cancellation-offer-popup-survey__continue-button").on("click",this.surveyContinueButtonPressed.bind(this)),this.$popupWrapper.find(".cancellation-offer-popup-discount-offer__dismiss-button").on("click",this.discountOfferCancelButtonPressed.bind(this)),this.$popupWrapper.find(".cancellation-offer-popup-discount-offer__continue-button").on("click",this.takeDiscountOffer.bind(this))},this.showDiscountOffer=function(){this.$popupWrapper.find(".cancellation-offer-popup-survey").hide(),this.$popupWrapper.find(".cancellation-offer-popup-discount-offer").show()},this.showSurvey=function(){this.$popupWrapper.find(".cancellation-offer-popup-survey").show(),this.$popupWrapper.find(".cancellation-offer-popup-discount-offer").hide()},this.getTextAnswer=function(){return this.$popupWrapper.find(".cancellation-offer-popup-survey-items__textarea textarea").val()},this.surveyAnswerSelected=function(e){this.blockContinueButton(),jQuery(".cancellation-offer-popup-survey-item").removeClass("cancellation-offer-popup-survey-item--active");e=jQuery(e.target).closest(".cancellation-offer-popup-survey-item");this.selectedSurveyAnswer={slug:e.data("slug"),textAnswerEnabled:"yes"===e.data("is-text-answer-enabled"),isDiscountOfferEnabled:"yes"===e.data("is-discount-offer-enabled")},"yes"===e.data("is-text-answer-enabled")?this.$popupWrapper.find(".cancellation-offer-popup-survey-items__textarea").show().trigger("change"):(jQuery(".cancellation-offer-popup-survey-items__textarea").hide(),this.unblockContinueButton()),e.addClass("cancellation-offer-popup-survey-item--active")},this.surveyContinueButtonPressed=function(){this.isDiscountOfferEnabled()&&this.selectedSurveyAnswer.isDiscountOfferEnabled?this.showDiscountOffer():this.cancelSubscription()},this.discountOfferCancelButtonPressed=function(){this.cancelSubscription()},this.cancelSubscription=function(){this.blockUI(),jQuery.ajax({url:this.$popupWrapper.data("cancel-subscription-url"),type:"GET",data:{survey_selected_answer_slug:this.selectedSurveyAnswer.slug,survey_text_answer:this.getTextAnswer()}}).done(function(){location.reload()})},this.takeDiscountOffer=function(){this.blockUI(),jQuery.ajax({url:this.$popupWrapper.data("take-discount-url"),type:"GET",data:{survey_selected_answer_slug:this.selectedSurveyAnswer.slug,survey_text_answer:this.getTextAnswer()}}).done(function(){location.reload()})},this.update=function(){this.selectedSurveyAnswer||this.blockContinueButton()},this.unblockContinueButton=function(){this.$popupWrapper.find(".cancellation-offer-popup-survey__continue-button").attr("disabled",!1)},this.blockContinueButton=function(){this.$popupWrapper.find(".cancellation-offer-popup-survey__continue-button").attr("disabled",!0)},this.open=function(){(this.isSurveyEnabled()||this.isDiscountOfferEnabled())&&(this.popup=jQuery.magnificPopup.open({items:{src:this.$popupWrapper,type:"inline"}}),this.isSurveyEnabled()?this.showSurvey():this.isDiscountOfferEnabled()&&this.showDiscountOffer())},this.isSurveyEnabled=function(){return"yes"===this.$popupWrapper.data("is-survey-enabled")},this.isDiscountOfferEnabled=function(){return"yes"===this.$popupWrapper.data("is-discount-offer-enabled")},this.blockUI=function(){this.$popupWrapper.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}},popup=new CancellationOfferPopup(jQuery("#cancellation-offer-popup"));popup.init();
